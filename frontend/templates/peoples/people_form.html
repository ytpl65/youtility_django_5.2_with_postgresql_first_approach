{% extends "globals/base_form.html" %}
{% from "onboarding/partials/partial_ta_form.html" import typeassist_form with context %}

<!---- BEGIN PAGE TITLE ---->
{% block title %}
People Form
{% endblock title %}
<!---- END PAGE TITLE ----->

<!---- BEGIN PAGE TITLE ------>
{% block page_title %}
People Form
{% endblock page_title %}
<!----- END PAGE TITLE -------->

{% block extra_css %}
{{ peopleform.media.css }}
<style>
.toggleeye {
    margin-top: 15px;
    margin-left: -30px;
}
</style>
{% endblock extra_css %}

<!-------------------------- BEGIN PAGE BREADCUMB ----------------------->
{% block pagebreadcumb %}
{{ super() }}
<li class="breadcrumb-item pe-3"><a href="{{ url('peoples:people') }}?template=true" class="pe-3">People List</a></li>
<li class="breadcrumb-item pe-3"><a href="javascript:void(0)" class="pe-3">People Form</a></li>
{% endblock pagebreadcumb %}
<!-------------------------- END PAGE BREADCUMB ------------------------->

<!-------------  BEGIN POP-UPS CODE -------------->
{% block popup_alerts %}
{{ super()  }}
{% if edit is defined %}
<!-- to delete an instance with popup_alert pass the delete_url_name, instance_id, popup_title, popup_id -->
{% call general_popup(title="Delete", popup_id="delete_alert") %}
<div class="modal-body">
    <h4>Are you sure, you want to delete this?</h4>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">No Go back</button>
    <a href="{{ url('peoples:people_delete', args=[peopleform.instance.id]) }}"
        class="btn btn-sm  btn-danger rounded-1">Yes I'm Sure</a>
</div>
{% endcall %}
{% endif %}

{% if peopleform.instance.id %}
{% call general_popup(popup_id = 'paswd_change_alert', title = 'Change Password', modal_size='modal-lg') %}
<div class="modal-body">
    <form id="passwordChangeForm" action="" method="post">
        <!---------------------------CSRF MIDDLEWARE TOKEN---------------------->
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        <input type="hidden" name="people" value="{{ peopleform.instance.id }}">
        <div class="row g-3">
            <div class="col-md-3"><label>Password:</label></div>
            <div class="col-md-9">
                <div class="d-flex">
                    <input type="password" class="form-control" name='new_password1'>
                    <i class="fas text-white fa-eye toggleeye"></i>
                </div>
                <div class="password_fields" for="new_password1"></div>
            </div>
            <div class="col-md-3"><label>Confirm Password:</label></div>
            <div class="col-md-9">
                <div class="d-flex">
                    <input type="password" class="form-control" name='new_password2'>
                    <i class="fas text-white fa-eye toggleeye"></i>
                </div>
                <div id="password_error" class="password_fields" for="new_password2"></div>
            </div>
        </div>
    </form>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <input form="passwordChangeForm" type="submit" value="Set Password" class="btn btn-sm btn-primary2 rounded-1" />
</div>
{% endcall %}
{% endif %}

<!------------- typeassist popup for peopletype onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "peopletype_popup") %}
<form action="" method="post" id="pop_peopletype_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        <input type="hidden" name="csrfto" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary2 rounded-1" value="Sumbit" form="pop_peopletype_form" />
    </div>
</form>
{% endcall %}
<!------------- typeassist popup for worktype onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "worktype_popup") %}
<form action="" method="post" id="pop_worktype_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        <input type="hidden" name="csrfto" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary2 rounded-1" value="Sumbit" form="pop_worktype_form" />
    </div>
</form>
{% endcall %}

<!------------- typeassist popup for department onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "department_popup") %}
<form action="" method="post" id="pop_dept_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary2 rounded-1" value="Sumbit" form="pop_dept_form" />
    </div>
</form>
{% endcall %}

<!------------- typeassist popup for designation  onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "designation_popup") %}
<form action="" method="post" id="pop_desgn_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary2 rounded-1" value="Sumbit" form="pop_desgn_form" />
    </div>
</form>
{% endcall %}

<!-- Moda for setting GPS coordianates-->
{% call general_popup(title="Set GPS Location", popup_id="open_map_perm", modal_size="modal-lg") %}
<div class="modal-body card">
    <div class="card-body p-0">
        <div id="map" style="width:750px; height:350px"></div>
    </div>
</div>
<div class="modal-footer d-flex justify-content-between">
    <div><p>Tip: Zoom in for accurate coordinates of address, place the marker and then set the coords.</p></div>
    <div></div>
    <div><a href="#" class="btn" id="close_setgps_perm" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary2" id="set_the_coords_perm">Set the coordinates</a></div>
    
</div>
{% endcall %}

<!-- Moda for setting GPS coordianates-->
{% call general_popup(title="Set GPS Location", popup_id="open_map_curr", modal_size="modal-lg") %}
<div class="modal-body card">
    <div class="card-body p-0">
        <div id="map2" style="width:750px; height:350px"></div>
    </div>
</div>
<div class="modal-footer d-flex justify-content-between">
    <div><p>Tip: Zoom in for accurate coordinates of address, place the marker and then set the coords.</p></div>
    <div></div>
    <div><a href="#" class="btn" id="close_setgps_curr" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary2" id="set_the_coords_curr">Set the coordinates</a></div>
    
</div>
{% endcall %}
{% endblock popup_alerts %}
<!-------------  END POP-UPS CODE -------------->

<!------ BEGIN FORM TITLE ------->
{% block form_title %}
People
{% endblock form_title %}
<!------ END FORM TITLE -------->

<!--------- BEGIN NON FIELD ERRORS -------->
{% block nonfield_errors %}
<div class="alert alert-danger" id="nonfield_errors"role="alert" style="display:none">
    <strong>Error: </strong> <span></span>
</div>
{% endblock nonfield_errors %}
<!---------- END NON FIELD ERRORS --------->


<!-------------- BEGIN FORM ------------------->
{% block form %}
<form action="" method="post" id="id_peopleform" enctype="multipart/form-data">
    <!--------------------------CSRF MIDDLEWARE TOKEN---------------------->
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    <input type="hidden" name="{{ peopleform.ctzoffset.name }}" id = "{{ peopleform.ctzoffset.auto_id }}" value="-1">
    <!--BEGIN FIRST ROW-->
    <div class="mb-3 row g-3 gx-6">
        <!--BEGIN FIRST COLUMN-->
        <div class="col-md-10">
            <!--BEGIN INNER ROW-->
            <div class="row g-3 gx-6 ">

                <!--LABEL FIELD-->
                <label class="required" for="id_peoplecode">Code:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.peoplecode }}

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.peoplecode.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <!--LABEL FIELD-->
                <label class="required" for="id_peoplename">Name:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.peoplename }}
                    <!--HELP TEXT-->

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.peoplename.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <!--LABEL FIELD-->
                <label class="required" for="id_loginid">Loginid:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.loginid }}

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.loginid.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <!--LABEL FIELD-->
                <label class="required" for="id_email">Email:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.email }}
                    <!--HELP TEXT-->

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.email.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label class="required" for="id_mobno">Mobno:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.mobno }}

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.mobno.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label class="required" for="id_gender">Gender:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.gender }}
                    <!--HELP TEXT-->

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.gender.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label class="required" for="id_dateofbirth">Date of Birth:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.dateofbirth }}
                    <!--HELP TEXT-->

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.dateofbirth.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label class="required" for="id_deviceid">Device Id:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4 d-flex d-inline">
                    {{ peopleform.deviceid }}
                    <button type='button' class="btn btn-sm btn-secondary rounded-0" id="id_reset">Reset</button>
                    <!--HELP TEXT-->
                </div>
                <!--LABEL FIELD-->


                <!--LABEL FIELD-->
                <label for="id_peopletype">Employee Type:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    <div class="d-flex flex-row">
                        {{ peopleform.peopletype }}
                        <a href="" type="button" data-bs-toggle="modal" data-bs-target="#peopletype_popup"><span
                                style="font-size: 24px;" data-bs-toggle="tooltip" data-bs-placement="left"
                                title="If you haven't found an option in the selection menu, then create one from here"
                                class="material-icons-outlined mt-3 ps-2 primary-col opacity-50">
                                add_circle
                            </span></a>
                    </div>

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.peopletype.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label class="" for="id_dateofjoin">Date of Joining:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.dateofjoin }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.dateofjoin.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->
                
                <!--LABEL FIELD-->
                <label class="" for="id_worktype">Work Type:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                <div class="d-flex flex-row">
                    {{ peopleform.worktype }}
                    <a href="" type="button" data-bs-toggle="modal" data-bs-target="#worktype_popup"><span
                                style="font-size: 24px;" data-bs-toggle="tooltip" data-bs-placement="left"
                                title="If you haven't found an option in selection menu, then create one from here"
                                class="material-icons-outlined mt-3 ps-2 primary-col opacity-50">
                                add_circle
                            </span></a>
                </div>
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.worktype.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->
                
                <!--LABEL FIELD-->
                <label class="required" for="id_dateofjoin">Site</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.bu }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.bu.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->
                <label class="" for="id_dateofjoin">Posting</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.location }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.location.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->
                <label class="required" for="id_dateofjoin">User For</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.userfor }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.userfor.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->
                <!------------Checkboxes Rendering Last --------------------->
                <div class="booleans col-md-6 d-flex justify-content-sm-between mt-5">
                    {% if request.user.isadmin %}
                    <!--ENABLE CHECKBOX -->
                    <label for = id_isenable class="form-check-label bool col-form-label me-5 text-sm-right">Enable
                        &nbsp {{ peopleform.enable }}</label>
                    {% endif %}
                     <!--BLACKLIST CHECKBOX -->
                    <label for = id_blacklist class="form-check-label bool col-form-label me-5 text-sm-right">Blacklist
                        &nbsp{{ pref_form.blacklist }}</label>
                    
                     <!--ISADMIN CHECKBOX -->
                    <label for = id_isadmin id="label_isadmin" class="form-check-label bool col-form-label me-5 text-sm-right">Admin
                        &nbsp{{ peopleform.isadmin }}</label>
                    
                     <!--ISEMERGENCYCONTACT CHECKBOX -->
                    <label for = id_isemergencycontact id="label_isemergencycontact" class="form-check-label bool col-form-label me-5 text-sm-right" >Emergency Contact
                        &nbsp{{ pref_form.isemergencycontact }}</label>
                    <!--ALERTMAILS CHECKBOX -->
                    <label for = id_alertmails id="label_alertmails" class="form-check-label bool col-form-label me-5 text-sm-right">Alert Mails
                        &nbsp{{ pref_form.alertmails }}</label>
                </div>
            </div>
            <!--END INNER ROW-->
        </div>
        <!--END FIRST COLUMN-->
        <!--BEGIN IMAGE INPUT-->
        <div class="col-md-2">

            <!--begin::Image input-->
            <div class="image-input image-input-empty"
            data-kt-image-input="true"
            style="background-image: url('{% if peopleform.instance.peopleimg and 'blank.png' in peopleform.instance.peopleimg.name %}{{ static('assets/media/images/blank.png') }}{% else %}{{ peopleform.instance.peopleimg.url }}{% endif %}')">
       
                <!--begin::Image preview wrapper-->
                <div class="image-input-wrapper w-125px h-125px"></div>
                <!--end::Image preview wrapper-->

                <!--begin::Edit button-->
                <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-white shadow"
                    data-kt-image-input-action="change" data-bs-toggle="tooltip" data-bs-dismiss="click"
                    title="Change avatar">
                    <span class="svg-icon svg-icon-1">
                        <span class="material-icons align-middle dark fs-5">
                            edit
                        </span>
                    </span>

                    <!--begin::Inputs-->
                    <input type="file" name="peopleimg" id="id_peopleimg" accept=".png, .jpg, .jpeg" />
                    <input type="hidden" name="avatar_remove" />
                    <!--end::Inputs-->
                </label>
                <!--end::Edit button-->

                <!--begin::Cancel button-->
                <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-white shadow"
                    data-kt-image-input-action="cancel" data-bs-toggle="tooltip" data-bs-dismiss="click"
                    title="Cancel avatar">
                    <span class="svg-icon svg-icon-1">
                        <span class="material-icons align-middle dark fs-5">
                            clear
                        </span>
                    </span>
                </span>
                <!--end::Cancel button-->

                <!--begin::Remove button-->
                <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-white shadow"
                    data-kt-image-input-action="remove" data-bs-toggle="tooltip" data-bs-dismiss="click"
                    title="Remove avatar">
                    <i class="bi bi-x fs-2"></i>
                </span>
                <!--end::Remove button-->
            </div>
            <!--end::Image input-->
        </div>
        <!--END IMAGE INPUT-->
    </div>

        {% if not request.user.is_superuser %}
            <!---BEGIN Add More Details --->
            <div class="d-flex flex-row justify-content-center mt-2">
                <p id="add_more" style="cursor:pointer; color:#009EF7" class="" id="add_more"><span id="ptxt"><u>Add more info</u></span>
                    <span class="material-icons-outlined align-middle">
                    arrow_downward
                    </span>     
                </p>
            </div>
            <!--END-Add More Details --->
        {% endif %}
    {% if peopleform.instance.password %}
        <button type="button" id="change_pass" class="btn btn-sm col-md-2 btn-primary2 rounded-1" data-bs-target='#paswd_change_alert'
            data-bs-toggle="modal">Change Password
            <span class="svg-icon svg-icon-2">
                <span class="material-icons h-19px" style="vertical-align: middle; font-size: 19px;">
                    lock
                </span>
            </span>
        </button>
    {% endif %}

    <!--END FIRST ROW-->
    <div class="mb-4 row" id="workinfo" style="display:none;">
        <section class="my-6">
            <h4>Work Information</h4>
            <hr>
            <div class="mb-3 row g-3 gx-6">

                <!--LABEL FIELD-->
                <label for="id_department">Department:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    <div class="d-flex flex-row">
                        {{ peopleform.department }}
                        <a href="" type="button" data-bs-toggle="modal" data-bs-target="#department_popup"><span
                                style="font-size: 24px;" data-bs-toggle="tooltip" data-bs-placement="left"
                                title="If you haven't found an option in selection menu, then create one from here"
                                class="material-icons-outlined mt-3 ps-2 primary-col opacity-50">
                                add_circle
                            </span></a>
                    </div>
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.department.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_designation">Designation:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    <div class="d-flex flex-row">
                        {{ peopleform.designation }}
                        <a href="" type="button" data-bs-toggle="modal" data-bs-target="#designation_popup"><span
                                style="font-size: 24px;" data-bs-toggle="tooltip" data-bs-placement="left"
                                title="If you haven't found an option in selection menu, then create one from here"
                                class="material-icons-outlined mt-3 ps-2 primary-col opacity-50">
                                add_circle
                            </span></a>
                    </div>

                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.designation.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_dateofreport">Date of Release:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.dateofreport }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.dateofreport.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_reportto">Report to:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ peopleform.reportto }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ peopleform.reportto.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

            </div>
        </section>
    </div>
    <div class="mb-4 row" id="capinfo" style="display:none">
        <section class="mb-6">
            <h4>Capability Information</h4>
            <hr>
            <div class="mb-3 row g-3 gx-6">

                <!--LABEL FIELD-->
                <label for="id_mobilecapability">Mobile Capability:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.mobilecapability }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.mobilecapability.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_portletcapability">Portlet Capability:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.portletcapability }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.portletcapability.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_reportcapability">Report Capability:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.reportcapability }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.reportcapability.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>
                <!--LABEL FIELD-->

                <!--LABEL FIELD-->
                <label for="id_webcapability">Web Capability:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.webcapability }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.webcapability.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

                <label for="id_noccapability">Noc Capability:</label>
                <!--INPUT GROUP-->
                <div class="col-md-4">
                    {{ pref_form.noccapability }}
                    <!--HELP TEXT-->
                    <!----- BEGIN ERROR FIELD  ------->
                    {{ pref_form.noccapability.errors }}
                    <!----- END ERROR FIELD  ------->
                </div>

            </div>
        </section>
    </div>

    <div class="mb-4 row" id="sgti" style="display:none">
        <section class="mb-6">
            <h4>Site Group and Template Information</h4>
            <hr>
            <div class="mb-3 row g-3 gx-6">
                <label for="id_assignsitegroup">Site Group:</label>
                <div class="col-md-4">
                    {{ pref_form.assignsitegroup }}
                    <!--HELP TEXT-->
                    <!--ERROR FIELD-->
                    {{ pref_form.assignsitegroup.errors }}
                </div>
                <label for="id_tempincludes">Template:</label>
                <div class="col-md-4">
                    {{ pref_form.tempincludes }}
                    <!--HELP TEXT-->
                    <!--ERROR FIELD-->
                    {{ pref_form.tempincludes.errors }}
                </div>
                <div class="booleans col-md-6 d-flex justify-content-sm-between mt-5">

                    <label for=id_showalltemplates
                        class="form-check-label bool col-form-label me-5 text-sm-right">{{ pref_form.showalltemplates }}
                        &nbspShow all Templates </label>
                    <label for=id_showtemplatebasedonfilter
                        class="form-check-label bool col-form-label me-5 text-sm-right">{{ pref_form.showtemplatebasedonfilter }}
                        &nbspDisplay site wise templates</label>

                </div>
            </div>
        </section>
    </div>
    <div class="mb-4 row" id="address" style="display:none">
        <section class="mb-6">
            <h4>Address Info</h4>
            <hr>
            <div class="mb-3 row g-3 gx-6">
                <label for="id_currentaddress">Current Address</label>
                <div class="col-md-4">
                    <div class="d-flex d-inline">
                        {{ pref_form.currentaddress }}
                        <button type='button' class="btn btn-sm btn-secondary rounded-right rounded-1" style="height:3.2rem;" id="id_setgps_curr">GPS</button>
                    </div>
                    
                    <!--HELP TEXT-->
                    <!--ERROR FIELD-->
                    {{ pref_form.currentaddress.errors }}
                </div>
                <label for="id_permanentaddress">Permanent Address</label>
                <div class="col-md-4">
                    <div class="d-flex d-inline">
                        {{ pref_form.permanentaddress }}
                        <button type='button' class="btn btn-sm btn-secondary rounded-right rounded-1" style="height:3.2rem;" id="id_setgps_perm">GPS</button>
                    </div>
                    <!--HELP TEXT-->
                    <!--ERROR FIELD-->
                    {{ pref_form.permanentaddress.errors }}
                </div>
            </div>
        </section>
    </div>
    
</form>

{% endblock form %}
<!------------- END FORM ---------------------->


<!-------------- BEGIN FORM PAGE ACTIONS --------->

{% if request.session['wizard_data'] is defined %}
{% block formpage_actions %}
<!--- BEGIN wizard Controls --->
{{ super() }}
<!-- END wizard Controls ------>
{% endblock formpage_actions %}
{% else %}

{% block page_actions %}
{% if edit is defined %}
{{ form_update('id_peopleform', popup_id="delete_alert") }}
{% else %}
{{ form_create('id_peopleform') }}
{% endif %}
{% endblock page_actions %}
<!------------------- END FORM PAGE ACTIONS ---------------->
{% endif %}


{% block extra_scripts %}
{{ peopleform.media.js }}
<script>
	var map, userMarker, currinfowindow, currAddr;
	function getLatLng(){
		return {lat:0.0, lng:0.0}
	}
</script>
<script src="{{ static('assets/js/local/maps.js') }}"></script>
<script src="{{ static('assets/js/just-validate.production.min.js') }}"></script>

<script>
    //toggle eye icon to eye-slash icon on click
    function toggleIcon() {
        var x = $('.toggleeye');
        if (x.hasClass("fa-eye")) {
            x.removeClass("fa-eye");
            x.addClass("fa-eye-slash");
            x.prev().attr('type') === 'password' ? x.prev().attr('type', 'text') : x.prev().attr('type', 'password');
        } else {
            x.removeClass("fa-eye-slash");
            x.addClass("fa-eye");
            x.prev().attr('type') === 'password' ? x.prev().attr('type', 'text') : x.prev().attr('type', 'password');
        }
    }

    $(document).ready(function () {
        //onclick id_setgps_curr open popup open_map_curr 
        const validator = new JustValidate('#id_peopleform', { errorFieldCssClass: 'is-invalid'});

        /* hides isadmin check when userfor field is mobile*/
        $('#id_userfor').change(function(){
            if ($(this).val() == 'Mobile') {
                $('#label_isadmin').hide()
                $('#id_isadmin').prop('checked', false)
            } else {
                $('#label_isadmin').show()
            }
        }
        )

        //add formvalidation to required fields
        $('#id_peopleform [required]').each(function() {
            // Retrieve and check if the element has an ID
            let fieldId = $(this).attr('id');
            if (fieldId) {
                // Add the field's ID to the array
                validator.addField("#"+fieldId, [
                    {rule:'required'}
                ])
            }
        });

		$("#id_setgps_curr").click(function(){
			$("#open_map_curr").modal('show');
			initMap("map2");
		});

        $("#close_setgps_curr").click(function(){
			$("#open_map_curr").modal('hide');
		});
        
        //onclick id_setgps_perm open popup open-map_perm
		$("#id_setgps_perm").click(function(){
			$("#open_map_perm").modal('show');
			initMap("map");
		});

        $("#close_setgps_perm").click(function(){
			$("#open_map_perm").modal('hide');
		});

        //onclick set the coords get lat and lng from useMarker and set to gpslocation field
		$("#set_the_coords_perm").click(function(){
			var lat = userMarker.getPosition().lat();
			var lng = userMarker.getPosition().lng();
			const geocoder = new google.maps.Geocoder()
			getAddressOfPoint(geocoder, {lat:lat, lng:lng}, (address) => {
				$("#id_permanentaddress").val(address.formattedAddress)
			})
			$("#open_map_perm").modal('hide');
		});
        
        //onclick set the coords get lat and lng from useMarker and set to gpslocation field
		$("#set_the_coords_curr").click(function(){
			var lat = userMarker.getPosition().lat();
			var lng = userMarker.getPosition().lng();
			const geocoder = new google.maps.Geocoder()
			getAddressOfPoint(geocoder, {lat:lat, lng:lng}, (address) => {
				$("#id_currentaddress").val(address.formattedAddress)
			})
			$("#open_map_curr").modal('hide');
		});
        
        //onclick 'toggleeye' call toggleIcon
        $('.toggleeye').click(function () {
            toggleIcon();
        });
        //reset deviceid on click
        $("#id_reset").click(function(){
            $("#id_deviceid").val('-1')
        })
        //set ctzoffset
        $("#id_ctzoffset").val(-new Date().getTimezoneOffset())

        //hide the delete button when instance is not saved yet.
        if ('{{peopleform.instance.id}}' === 'None') {
            $("#btn_del").hide()
        }
        //hide site group and template info
        session = {{ dict(request.session) | default ("") | tojson }}
        if (session && session['wizard_data']) {
            $('#sgti').hide()
        }

        $("#btn_clear").click(() => {
            location.href = "{{ url('peoples:people') }}?action=form"
        })

        /*add class to labels of modals or 
		popup-taform to adjust the grid properly*/
        $('.row > label').addClass('col-sm-2')
        // submit the popup-taform for validation and saving in db.

        $("#add_more").click(function () {
            //show more fields to add in peopleform
            $('#capinfo, #sgti, #workinfo, #address').toggle()
        })
        //on submit password change form
        $('#passwordChangeForm').on('submit', function (e) {
            console.log('triggered')
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{{ url('peoples:people_change_paswd') }}",
                data: $('#passwordChangeForm').serialize(),
                success: function (data, status, xhr) {
                    console.log(data)
                    $('#password_msgs').html("")
                    if (data['status'] == 500) {
                        let error_field = $('#password_error');
                        let errors = data['res']['new_password2'].map(
                            error => {
                                let li = document.createElement('li');
                                li.textContent = error
                                $(li).css('color', 'red')
                                return li;
                            }
                        );
                        error_field.html("");
                        error_field.append(...errors)
                    } else {
                        $('#paswd_change_alert').modal('hide')
                    }

                }
            })
        })

        //hide next btn if instance is not saved yet
        if (session['wizard_data'] && session['wizard_data']['peoples'].length == 0) {
            $('#next_btn').hide()
        }

        // submit the popup-peopletype-taform for validation and saving in db.
        $('#pop_peopletype_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_peopletype_form",
            'field': "#id_peopletype",
            'modal': "#peopletype_popup"
        }))
        
        // submit the popup-worktype-taform for validation and saving in db.
        $('#pop_worktype_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_worktype_form",
            'field': "#id_worktype",
            'modal': "#worktype_popup"
        }))

        // submit the popup-department-taform for validation and saving in db.
        $('#pop_dept_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_dept_form",
            'field': "#id_department",
            'modal': "#department_popup"
        }))

        // submit the popup-peopletype-taform for validation and saving in db.
        $('#pop_desgn_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_desgn_form",
            'field': "#id_designation",
            'modal': "#designation_popup"
        }))

        //ADD CALENDER TO DATE FIELDS WITH FLAT-PICKR PLUGIN
        $("#id_dateofbirth, #id_dateofjoin, #id_dateofreport").flatpickr({
            dateFormat: 'd-M-Y'
        })
        
        $("#id_dateofbirth, #id_dateofjoin, #id_dateofreport").addClass("form-control")

        //Add More Details toggle
        $("#add_more").click(() => {
            $('#add_more' > '#ptxt').text((i, text) => {
                return text === "Add more info" ? "Hide more info" : "Add more info";
            })
        })
        
        //for select2 search work in bootstrap modals
        $("#department_popup").find("select[name = tatype]").select2({
            dropdownParent: $('#department_popup')
        })
        $("#designation_popup").find("select[name = tatype]").select2({
            dropdownParent: $('#designation_popup')
        })
        $("#peopletype_popup").find("select[name = tatype]").select2({
            dropdownParent: $('#peopletype_popup')
        })
        $("#worktype_popup").find("select[name = tatype]").select2({
            dropdownParent: $('#worktype_popup')
        })
        //hide change_pass feature for session wizard
        if(session['wizard_data']){
            $("#change_pass").hide()
        }
        //pre-select options for pop-up ta forms
		$("#peopletype_popup select[name='tatype']").val($("#peopletype_popup select option:contains('People Type')").val()).change().prop({"disabled": "true"})
        
        //pre-select options for pop-up ta forms
		$("#worktype_popup select[name='tatype']").val($("#worktype_popup select option:contains('Work Type')").val()).change().prop({"disabled": "true"})
        
        //pre-select options for pop-up ta forms
		$("#designation_popup select[name='tatype']").val($("#designation_popup select option:contains('Designation')").val()).change().prop({"disabled": "true"})
        
        //pre-select options for pop-up ta forms
		$("#department_popup select[name='tatype']").val($("#department_popup select option:contains('Department')").val()).change().prop({"disabled": "true"})
        
        //show isadmin checkbox to superuser
        if(session.is_admin){
            $("#label_isadmin, #id_isadmin").show()
        }else{$("#label_isadmin, #id_isadmin").hide()}
        
        //sets closeonSelect to false for multiple-select fields
        $("[multiple]").select2({
            closeOnSelect:false 
        })

        //on form submit
        $("#id_peopleform").on('submit', function(e){
            e.preventDefault()
            var form = $(this)
            const params = {url: "{{ url('peoples:people') }}", modal:false}
            const id = "{{ peopleform.instance.pk }}"
            var formdata = new FormData();
            formdata.append('formData', form.serialize())
            var peopleimg = $("#id_peopleimg")[0].files[0]
            formdata.append('peopleimg', peopleimg)
            formdata.append('csrfmiddlewaretoken', '{{ csrf_token }}')
            var payLoad = {formData:form.serialize(), csrfmiddlewaretoken: '{{ csrf_token }}'}//payload for post request
            if(id != 'None'){
                formdata.append('pk', id)
                //var newPayLoad = {...payLoad, 'pk':id}
                //payLoad = newPayLoad
            }
            fire_ajax_fileform_post(params, formdata)
            .done((data, status, xhr) => { //function to submit post request
                show_successful_save_alert(update= id != 'None' ? true : false)
                window.setTimeout(function() {
                    window.location.href = `{{ url('peoples:people') }}?id=${data.pk}`;
                }, 2000);
            })
        })

        //on delete form
        function deletePeople(elemt){
            var id = "{{ peopleform.instance.id }}"
            show_alert_before_delete('People')
            .then((result) => {
                if(result.isConfirmed){ //delete requested by user
                    status = isSiteGrpDeleted(id) //fire's request
                    console.log("status ", status)
                    if(status){
                        show_successful_delete_alert() //defined in customjs
                        $(modal_id).modal("hide")
                        //delete row from table
                        row_index = parseInt($(modalcontent_id).attr('data-rowid'), 10)
                        table.search().ajax.reload()
                        console.log("table reloaded")
                    }else{
                        show_error_alert('Something went wrong!');
                    }
                }
            })
        }
    })
</script>
{% endblock extra_scripts %}